<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025ë…„ë„ ìƒë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œ ìš°ìˆ˜ê³¼ì œ í‰ê°€</title>

    <!-- Firebase SDK ì¶”ê°€ -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            background: #007bff;
            color: white;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .nav-tab.active:hover {
            background: #0056b3;
            color: white;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group select, .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .evaluation-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .evaluation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .evaluation-item label {
            font-weight: bold;
            color: #333;
            margin-bottom: 0;
        }
        
        .evaluation-item input {
            width: 120px;
            text-align: center;
            margin-left: 10px;
            font-size: 1.2em;
            font-weight: bold;
            padding: 15px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }
        
        .pagination span {
            margin: 0 15px;
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
        }
        
        .result-card h3 {
            color: #007bff;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .score-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .score-detail:last-child {
            border-bottom: none;
        }
        
        .final-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #28a745;
            text-align: center;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .status-card {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .status-complete {
            background: #d4edda;
            color: #155724;
        }
        
        .status-incomplete {
            background: #f8d7da;
            color: #721c24;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .hidden {
            display: none;
        }
        
        .evaluation-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border-radius: 15px;
        }
        
        .evaluation-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .evaluation-header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        /* ì»¤ìŠ¤í…€ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 400px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .modal-content p {
            margin-bottom: 25px;
            color: #666;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>2025ë…„ë„ ìƒë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œ ìš°ìˆ˜ê³¼ì œ í‰ê°€</h1>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('evaluator')">í‰ê°€ ì°¸ì—¬</button>
            <button class="nav-tab admin-only" onclick="showSection('admin')" style="display: none;">ê´€ë¦¬ì ëª¨ë‹ˆí„°ë§</button>
            <button class="nav-tab admin-only" onclick="showSection('results')" style="display: none;">ê²°ê³¼ í™•ì¸</button>
        </div>
        
        <div class="content">
            <!-- í‰ê°€ì ì…ì¥ -->
            <div id="evaluator" class="section active">
                <div class="alert alert-info" style="margin-bottom: 30px; font-size: 1.1em; line-height: 1.8;">
                    <h3 style="color: #0c5460; margin-bottom: 20px; text-align: center;">
                        ğŸ† 2025ë…„ ìƒë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œ í‰ê°€ ì•ˆë‚´ ğŸ†
                    </h3>
                    <p style="margin-bottom: 15px;">
                        <strong>2025ë…„ ìƒë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œì— ì°¸ì—¬í•´ì£¼ì‹  ì„ì§ì› ì—¬ëŸ¬ë¶„ ëª¨ë‘ ê°ì‚¬í•©ë‹ˆë‹¤.</strong>
                    </p>
                    <p style="margin-bottom: 15px;">
                        ì˜¤ëŠ˜ í–‰ì‚¬ë¥¼ í†µí•´ ì ì‹œë‚˜ë§ˆ ë¬´ë”ìœ„ë¥¼ ìŠê³  í¸ì•ˆí•˜ê³  ì¦ê²ê²Œ ì‰¬ì–´ê°€ëŠ” í•˜ë£¨ ë³´ë‚´ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.
                    </p>
                    <p style="margin-bottom: 15px;">
                        ì‚¬ì „ì‹¬ì‚¬ë¥¼ í†µí•´ ì„ ë°œëœ <strong>ìš°ìˆ˜ê³¼ì œ 8ê±´</strong>ì— ëŒ€í•œ ë°œí‘œë¥¼ ê²½ì²­í•´ì£¼ì‹œê³ ,<br>
                        ê³µì •í•œ ì‹œê°ìœ¼ë¡œ í‰ê°€ì— ì°¸ì—¬í•´ì£¼ì‹œê¸°ë¥¼ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
                    </p>
                    <p style="margin-bottom: 15px;">
                        í•´ë‹¹ í‰ê°€ì‹œìŠ¤í…œì€ AI ì–´ì‹œìŠ¤í„´íŠ¸ '<strong>í´ë¡œë“œ</strong>'ë¥¼ í™œìš©í•˜ì—¬ ë§Œë“  í‰ê°€ í”„ë¡œê·¸ë¨ìœ¼ë¡œ,<br>
                        ë³´ë‹¤ ì‹ ì†í•˜ê³  ì •í™•í•œ ì ìˆ˜ì§‘ê³„ë¥¼ ìœ„í•´ ì œì‘í•˜ì˜€ìŠµë‹ˆë‹¤^^
                    </p>
                    <p style="margin-bottom: 15px;">
                        í‰ê°€ ë„ì¤‘ ë¬¸ì˜ì‚¬í•­ì´ ìˆëŠ” ê²½ìš°, ê·¼ì²˜ì˜ <strong>ê¸°íšì¡°ì •ì‹¤ ì§ì›</strong>ì—ê²Œ ë¬¸ì˜í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
                    </p>
                    <p style="text-align: center; font-size: 1.2em; color: #0c5460; font-weight: bold; margin-bottom: 0;">
                        ê·¸ëŸ¼ ì´ì œ í‰ê°€ë¥¼ ì‹œì‘í•´ë³¼ê¹Œìš”^^?
                    </p>
                </div>
                
                <div id="evaluatorLogin" class="evaluation-form">
                    <h2>í‰ê°€ì ì •ë³´ ì…ë ¥</h2>
                    <div class="form-group">
                        <label for="evaluatorType">í‰ê°€ì êµ¬ë¶„</label>
                        <select id="evaluatorType">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="executive">ì„ì›</option>
                            <option value="employee">ì§ì›</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="executiveNameGroup" style="display: none;">
                        <label for="evaluatorPosition">ì§ìœ„</label>
                        <select id="evaluatorPosition">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì´ì‚¬ì¥">ì´ì‚¬ì¥</option>
                            <option value="ê²½ì˜ì „ëµë³¸ë¶€ì¥">ê²½ì˜ì „ëµë³¸ë¶€ì¥</option>
                            <option value="ë³µì§€ê²½ì œë³¸ë¶€ì¥">ë³µì§€ê²½ì œë³¸ë¶€ì¥</option>
                            <option value="ë¬¸í™”ì²´ìœ¡ë³¸ë¶€ì¥">ë¬¸í™”ì²´ìœ¡ë³¸ë¶€ì¥</option>
                            <option value="ë„ë¡œê´€ë¦¬ë³¸ë¶€ì¥">ë„ë¡œê´€ë¦¬ë³¸ë¶€ì¥</option>
                            <option value="ì‹œì„¤ì•ˆì „ë³¸ë¶€ì¥">ì‹œì„¤ì•ˆì „ë³¸ë¶€ì¥</option>
                            <option value="êµí†µì‚¬ì—…ë³¸ë¶€ì¥">êµí†µì‚¬ì—…ë³¸ë¶€ì¥</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="employeeNameGroup" style="display: none;">
                        <label for="evaluatorName">ì„±ëª…</label>
                        <input type="text" id="evaluatorName" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <div class="form-group" id="employeeDeptGroup" style="display: none;">
                        <label for="evaluatorDept">ì†Œì†</label>
                        <select id="evaluatorDept">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="startEvaluation()">í‰ê°€ ì‹œì‘</button>
                </div>
                
                <div id="evaluationArea" class="hidden">
                    <div class="evaluation-header">
                        <h2 id="currentDeptName"></h2>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    
                    <div class="evaluation-form">
                        <div class="evaluation-item">
                            <label>ì°½ì˜ì„± (18~30ì )</label>
                            <input type="number" id="creativity" min="18" max="30" placeholder="18~30" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        
                        <div class="evaluation-item">
                            <label>ë‚œì´ë„ (18~30ì )</label>
                            <input type="number" id="difficulty" min="18" max="30" placeholder="18~30" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        
                        <div class="evaluation-item">
                            <label>íš¨ê³¼ì„± (12~20ì )</label>
                            <input type="number" id="effectiveness" min="12" max="20" placeholder="12~20" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        
                        <div class="evaluation-item">
                            <label>ì „íŒŒì„± (6~10ì )</label>
                            <input type="number" id="spreadability" min="6" max="10" placeholder="6~10" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        
                        <div class="evaluation-item">
                            <label>ê¸°ì—¬ë„ (6~10ì )</label>
                            <input type="number" id="contribution" min="6" max="10" placeholder="6~10" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        
                        <div class="evaluation-item">
                            <label>ì´ì </label>
                            <input type="text" id="totalScore" readonly placeholder="ì´ì ">
                        </div>
                    </div>
                    
                    <div class="pagination">
                        <button class="btn btn-primary" onclick="previousEvaluation()" id="prevBtn">ì´ì „</button>
                        <span id="pageInfo">1 / 8</span>
                        <button class="btn btn-primary" onclick="nextEvaluation()" id="nextBtn">ë‹¤ìŒ</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="showPreview()" id="submitBtn" style="display: none;">í‰ê°€ ì™„ë£Œ</button>
                    </div>
                </div>
                
                <!-- ë¯¸ë¦¬ë³´ê¸° í˜ì´ì§€ -->
                <div id="previewArea" class="hidden">
                    <div class="evaluation-header">
                        <h2>ğŸ“‹ í‰ê°€ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h2>
                        <p>ì œì¶œí•˜ê¸° ì „ì— í‰ê°€ ë‚´ìš©ì„ ìµœì¢… í™•ì¸í•´ì£¼ì„¸ìš”</p>
                    </div>
                    
                    <div id="previewContent" class="evaluation-form">
                        <!-- ë¯¸ë¦¬ë³´ê¸° ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                    
                    <div class="pagination">
                        <button class="btn btn-primary" onclick="returnToEvaluation()">ìˆ˜ì •í•˜ê¸°</button>
                        <button class="btn btn-success" onclick="finalSubmission()">ìµœì¢… ì œì¶œ</button>
                    </div>
                </div>
                
                <!-- ê°ì‚¬ ë©”ì‹œì§€ í™”ë©´ -->
                <div id="thankYouArea" class="hidden">
                    <div style="display: flex; align-items: center; justify-content: center; min-height: 70vh;">
                        <h1 style="font-size: 2.5em; color: #333;">í‰ê°€ì— ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤^^</h1>
                    </div>
                </div>
            </div>
            
            <!-- ê´€ë¦¬ì ì…ì¥ -->
            <div id="admin" class="section">
                <h2>í‰ê°€ í˜„í™© ëª¨ë‹ˆí„°ë§</h2>
                
                <div class="alert alert-info">
                    <strong>í˜„ì¬ í‰ê°€ í˜„í™©:</strong> ì‹¤ì‹œê°„ìœ¼ë¡œ ê° ë¶€ì„œë³„ í‰ê°€ ì™„ë£Œ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="refreshStatus()">ìƒíƒœ ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-success" onclick="exportResults()">ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-danger" onclick="showDeleteEvaluator()">ë°ì´í„° ì‚­ì œ</button>
                    <button class="btn btn-danger" onclick="resetAllData()">ì „ì²´ ì´ˆê¸°í™”</button>
                </div>
                
                <!-- ê°œë³„ ì‚­ì œ ì˜ì—­ -->
                <div id="deleteSection" class="hidden" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="margin-bottom: 15px;">ê°œë³„ í‰ê°€ì ì‚­ì œ</h4>
                    <div class="form-group">
                        <label for="deleteEvaluatorSelect">ì‚­ì œí•  í‰ê°€ì ì„ íƒ</label>
                        <select id="deleteEvaluatorSelect" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="hideDeleteEvaluator()">ì·¨ì†Œ</button>
                        <button class="btn btn-danger" onclick="deleteSelectedEvaluator()">ì‚­ì œ</button>
                    </div>
                </div>
                
                <h3>ì„ì› í‰ê°€ í˜„í™©</h3>
                <div id="executiveStatus" class="status-grid"></div>
                
                <h3>ì§ì› í‰ê°€ í˜„í™©</h3>
                <div id="employeeStatus" class="status-grid"></div>
            </div>
            
            <!-- ê²°ê³¼ í™•ì¸ -->
            <div id="results" class="section">
                <h2>í‰ê°€ ê²°ê³¼</h2>
                
                <div class="form-group">
                    <button class="btn btn-success" onclick="showFinalRanking()">ìµœì¢… ìˆœìœ„</button>
                    <button class="btn btn-primary" onclick="calculateResults()">ê²°ê³¼ ê³„ì‚°</button>
                </div>
                
                <div id="resultsArea" class="results-grid">
                    <div style="display: flex; align-items: center; justify-content: center; min-height: 40vh; text-align: center;">
                        <div>
                            <h3 style="color: #666; margin-bottom: 20px;">ğŸ“Š í‰ê°€ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì‹œë ¤ë©´</h3>
                            <p style="font-size: 1.2em; color: #999;">ìœ„ì˜ 'ê²°ê³¼ ê³„ì‚°' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- í‰ê°€ ì™„ë£Œ í™”ë©´ -->
            <div id="thankYouScreen" class="section">
                <div style="display: flex; align-items: center; justify-content: center; min-height: 70vh;">
                    <h1 style="font-size: 3em; color: #28a745; text-align: center;">í‰ê°€ì— ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤^^</h1>
                </div>
            </div>
        </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ ëª¨ë‹¬ -->
    <div id="customModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">ì•Œë¦¼</h3>
            <p id="modalMessage"></p>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="modalConfirm">í™•ì¸</button>
                <button class="btn btn-danger" id="modalCancel" style="display: none;">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase ì„¤ì • ë° ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyDdMIoq-H7UTLYRLvL1alv4sB7q6IyfdbE",
            authDomain: "sisul25.firebaseapp.com",
            databaseURL: "https://sisul25-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "sisul25",
            storageBucket: "sisul25.appstore.com",
            messagingSenderId: "1053271765928",
            appId: "1:1053271765928:web:6fa1d25796f2b503b9e39d"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        database.ref('allEvaluations').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                allEvaluations = data;
                if (isAdminMode) {
                    refreshStatus();
                }
            }
        });

        database.ref('completedEvaluators').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                completedEvaluators = data;
            }
        });
        // ê¸°ë³¸ ë°ì´í„° ì„¤ì •
        const departments = [
            'ITì „ëµì‹¤', 'ì¥ì• ì¸ì½œíƒì‹œìš´ì˜ì²˜', 'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›', 'ì²­ê³„ì²œê´€ë¦¬ì²˜', 
            'ìì‚°ê´€ë¦¬í˜ì‹ ì²˜', 'ê³µì‚¬ê°ë…1ì²˜', 'ì£¼ì°¨ì‹œì„¤ìš´ì˜ì²˜', 'ê³µê³µìì „ê±°ìš´ì˜ì²˜'
        ];
        
        const allDepartments = [
            'ê°ì‚¬ì‹¤', 'ì•ˆì „ì²˜', 'ê¸°íšì¡°ì •ì‹¤', 'ì¸ì‚¬ë…¸ë¬´ì²˜', 'ì´ë¬´ì²˜', 'í™ë³´ì‹¤', 'ì¸ì¬ë¬¸í™”ì›', 'ITì „ëµì‹¤',
            'ìƒê°€ìš´ì˜ì²˜', 'ì¶”ëª¨ì‹œì„¤ìš´ì˜ì²˜', 'ì¥ì• ì¸ì½œíƒì‹œìš´ì˜ì²˜', 'ì„œìš¸ì›”ë“œì»µê²½ê¸°ì¥ìš´ì˜ì²˜', 'ë”ê²½ê¸°ì¥ìš´ì˜ì²˜', 
            'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›', 'ì²­ê³„ì²œê´€ë¦¬ì²˜', 'ë‚¨ì‚°ê³¤ëŒë¼ì¸ìˆ˜ë‹¨TF', 'ìì‚°ê´€ë¦¬í˜ì‹ ì²˜', 'ë„ë¡œê´€ë¦¬ì²˜', 
            'ë„ë¡œì‹œì„¤ì²˜', 'ë„ë¡œê¸°ì „ì²˜', 'ë„ë¡œí™˜ê²½ì²˜', 'êµí†µì •ë³´ì²˜', 'ê³µì‚¬ê°ë…1ì²˜', 'ê³µì‚¬ê°ë…2ì²˜', 
            'ê³µì‚¬ê°ë…3ì²˜', 'ê³µë™êµ¬ê´€ë¦¬ì²˜', 'ìƒìˆ˜ë„ì§€ì›ì²˜', 'ì£¼ì°¨ì‹œì„¤ìš´ì˜ì²˜', 'êµí†µì‹œì„¤ìš´ì˜ì²˜', 'ê³µê³µìì „ê±°ìš´ì˜ì²˜'
        ];
        
        const executives = [
            { name: 'ì´ì‚¬ì¥', dept: 'ì´ì‚¬ì¥', cannotEvaluate: [] },
            { name: 'ê²½ì˜ì „ëµë³¸ë¶€ì¥', dept: 'ê²½ì˜ì „ëµë³¸ë¶€', cannotEvaluate: ['ê¸°íšì¡°ì •ì‹¤', 'ì¸ì‚¬ë…¸ë¬´ì²˜', 'ì´ë¬´ì²˜', 'í™ë³´ì‹¤', 'ì¸ì¬ë¬¸í™”ì›', 'ITì „ëµì‹¤'] },
            { name: 'ë³µì§€ê²½ì œë³¸ë¶€ì¥', dept: 'ë³µì§€ê²½ì œë³¸ë¶€', cannotEvaluate: ['ìƒê°€ìš´ì˜ì²˜', 'ì¶”ëª¨ì‹œì„¤ìš´ì˜ì²˜', 'ì¥ì• ì¸ì½œíƒì‹œìš´ì˜ì²˜'] },
            { name: 'ë¬¸í™”ì²´ìœ¡ë³¸ë¶€ì¥', dept: 'ë¬¸í™”ì²´ìœ¡ë³¸ë¶€', cannotEvaluate: ['ì„œìš¸ì›”ë“œì»µê²½ê¸°ì¥ìš´ì˜ì²˜', 'ë”ê²½ê¸°ì¥ìš´ì˜ì²˜', 'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›', 'ì²­ê³„ì²œê´€ë¦¬ì²˜', 'ë‚¨ì‚°ê³¤ëŒë¼ì¸ìˆ˜ë‹¨TF'] },
            { name: 'ë„ë¡œê´€ë¦¬ë³¸ë¶€ì¥', dept: 'ë„ë¡œê´€ë¦¬ë³¸ë¶€', cannotEvaluate: ['ìì‚°ê´€ë¦¬í˜ì‹ ì²˜', 'ë„ë¡œê´€ë¦¬ì²˜', 'ë„ë¡œì‹œì„¤ì²˜', 'ë„ë¡œê¸°ì „ì²˜', 'ë„ë¡œí™˜ê²½ì²˜', 'êµí†µì •ë³´ì²˜'] },
            { name: 'ì‹œì„¤ì•ˆì „ë³¸ë¶€ì¥', dept: 'ì‹œì„¤ì•ˆì „ë³¸ë¶€', cannotEvaluate: ['ê³µì‚¬ê°ë…1ì²˜', 'ê³µì‚¬ê°ë…2ì²˜', 'ê³µì‚¬ê°ë…3ì²˜', 'ê³µë™êµ¬ê´€ë¦¬ì²˜', 'ìƒìˆ˜ë„ì§€ì›ì²˜'] },
            { name: 'êµí†µì‚¬ì—…ë³¸ë¶€ì¥', dept: 'êµí†µì‚¬ì—…ë³¸ë¶€', cannotEvaluate: ['ì£¼ì°¨ì‹œì„¤ìš´ì˜ì²˜', 'êµí†µì‹œì„¤ìš´ì˜ì²˜', 'ê³µê³µìì „ê±°ìš´ì˜ì²˜'] }
        ];
        
        // ì „ì—­ ë³€ìˆ˜
        let currentEvaluator = null;
        let currentPage = 0;
        let evaluations = [];
        let allEvaluations = [];
        let completedEvaluators = []; // í‰ê°€ ì™„ë£Œí•œ í‰ê°€ì ëª©ë¡
        let isAdminMode = false; // ê´€ë¦¬ì ëª¨ë“œ ì—¬ë¶€
        let isAdminAuthenticated = false; // ê´€ë¦¬ì ì¸ì¦ ìƒíƒœ
        const ADMIN_PASSWORD = 'sisul2025'; // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
        
        // ì»¤ìŠ¤í…€ ì•Œë¦¼ ë° í™•ì¸ í•¨ìˆ˜
        function showAlert(message) {
            return new Promise((resolve) => {
                document.getElementById('modalTitle').textContent = 'ì•Œë¦¼';
                document.getElementById('modalMessage').textContent = message;
                document.getElementById('modalConfirm').textContent = 'í™•ì¸';
                document.getElementById('modalCancel').style.display = 'none';
                document.getElementById('customModal').style.display = 'block';
                
                document.getElementById('modalConfirm').onclick = () => {
                    document.getElementById('customModal').style.display = 'none';
                    resolve(true);
                };
            });
        }
        
        function showConfirm(message) {
            return new Promise((resolve) => {
                document.getElementById('modalTitle').textContent = 'í™•ì¸';
                document.getElementById('modalMessage').textContent = message;
                document.getElementById('modalConfirm').textContent = 'í™•ì¸';
                document.getElementById('modalCancel').style.display = 'inline-block';
                document.getElementById('customModal').style.display = 'block';
                
                document.getElementById('modalConfirm').onclick = () => {
                    document.getElementById('customModal').style.display = 'none';
                    resolve(true);
                };
                
                document.getElementById('modalCancel').onclick = () => {
                    document.getElementById('customModal').style.display = 'none';
                    resolve(false);
                };
            });
        }
        
        // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•¨ìˆ˜
        function showPasswordPrompt() {
            return new Promise((resolve) => {
                document.getElementById('modalTitle').textContent = 'ê´€ë¦¬ì ì¸ì¦';
                document.getElementById('modalMessage').innerHTML = `
                    <p style="margin-bottom: 15px;">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</p>
                    <input type="password" id="adminPasswordInput" 
                           style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 5px; font-size: 1em;"
                           placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                `;
                document.getElementById('modalConfirm').textContent = 'í™•ì¸';
                document.getElementById('modalCancel').style.display = 'inline-block';
                document.getElementById('customModal').style.display = 'block';
                
                // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
                setTimeout(() => {
                    document.getElementById('adminPasswordInput').focus();
                }, 100);
                
                // Enter í‚¤ ì²˜ë¦¬
                document.getElementById('adminPasswordInput').onkeypress = (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('modalConfirm').click();
                    }
                };
                
                document.getElementById('modalConfirm').onclick = () => {
                    const password = document.getElementById('adminPasswordInput').value;
                    document.getElementById('customModal').style.display = 'none';
                    resolve(password);
                };
                
                document.getElementById('modalCancel').onclick = () => {
                    document.getElementById('customModal').style.display = 'none';
                    resolve(null);
                };
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê´€ë¦¬ì ëª¨ë“œ í™•ì¸
        function checkAdminMode() {
            const urlParams = new URLSearchParams(window.location.search);
            isAdminMode = urlParams.get('admin') === 'true';
            
            if (isAdminMode) {
                // ê´€ë¦¬ì íƒ­ë“¤ì„ ë³´ì´ê²Œ í•¨
                document.querySelectorAll('.admin-only').forEach(element => {
                    element.style.display = 'inline-block';
                });
                
                // í˜ì´ì§€ ì œëª©ì— ê´€ë¦¬ì í‘œì‹œ ì¶”ê°€
                const header = document.querySelector('.header h1');
                header.textContent += ' - ê´€ë¦¬ì ëª¨ë“œ';
            } else {
                // í‰ê°€ì ëª¨ë“œì—ì„œëŠ” ê´€ë¦¬ì íƒ­ ì™„ì „íˆ ìˆ¨ê¹€
                document.querySelectorAll('.admin-only').forEach(element => {
                    element.style.display = 'none';
                });
            }
        }
        
        // DOM ë¡œë“œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            // ê´€ë¦¬ì ëª¨ë“œ í™•ì¸
            checkAdminMode();
            
            document.getElementById('evaluatorType').addEventListener('change', updateDepartmentOptions);
            
            const scoreInputs = ['creativity', 'difficulty', 'effectiveness', 'spreadability', 'contribution'];
            scoreInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        // ì‹¤ì‹œê°„ ì ìˆ˜ ê²€ì¦
                        let min, max;
                        switch(id) {
                            case 'creativity':
                            case 'difficulty':
                                min = 18; max = 30;
                                break;
                            case 'effectiveness':
                                min = 12; max = 20;
                                break;
                            case 'spreadability':
                            case 'contribution':
                                min = 6; max = 10;
                                break;
                        }
                        validateScore(this, min, max);
                        saveCurrentEvaluation();
                        updateTotalScore();
                    });
                }
            });
            
            // ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œë§Œ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
            if (isAdminMode) {
                refreshStatus();
            }
        });
        
        function updateDepartmentOptions() {
            const type = document.getElementById('evaluatorType').value;
            const executiveNameGroup = document.getElementById('executiveNameGroup');
            const employeeNameGroup = document.getElementById('employeeNameGroup');
            const employeeDeptGroup = document.getElementById('employeeDeptGroup');
            const deptSelect = document.getElementById('evaluatorDept');
            
            executiveNameGroup.style.display = 'none';
            employeeNameGroup.style.display = 'none';
            employeeDeptGroup.style.display = 'none';
            
            deptSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            document.getElementById('evaluatorPosition').value = '';
            document.getElementById('evaluatorName').value = '';
            
            if (type === 'executive') {
                executiveNameGroup.style.display = 'block';
            } else if (type === 'employee') {
                employeeNameGroup.style.display = 'block';
                employeeDeptGroup.style.display = 'block';
                
                allDepartments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    deptSelect.appendChild(option);
                });
            }
        }
        
        function showSection(sectionName) {
            // í‰ê°€ì ëª¨ë“œì—ì„œ ê´€ë¦¬ì íƒ­ ì ‘ê·¼ ì‹œë„ ì‹œ ì°¨ë‹¨
            if (!isAdminMode && (sectionName === 'admin' || sectionName === 'results')) {
                showAlert('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê´€ë¦¬ì íƒ­ ì ‘ê·¼ ì‹œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ (ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ)
            if (isAdminMode && (sectionName === 'admin' || sectionName === 'results') && !isAdminAuthenticated) {
                authenticateAdmin(sectionName);
                return;
            }
            
            // í‰ê°€ ì°¸ì—¬ íƒ­ì„ í´ë¦­í–ˆì„ ë•Œ í¼ ì´ˆê¸°í™”
            if (sectionName === 'evaluator') {
                resetEvaluatorForm();
            }
            
            // ê²°ê³¼ í™•ì¸ íƒ­ì„ í´ë¦­í–ˆì„ ë•Œ ê¸°ë³¸ í™”ë©´ìœ¼ë¡œ ì´ˆê¸°í™”
            if (sectionName === 'results') {
                resetResultsArea();
            }
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionName === 'admin') {
                refreshStatus();
            }
        }
        
        // ê²°ê³¼ í™•ì¸ íƒ­ ê¸°ë³¸ í™”ë©´ìœ¼ë¡œ ì´ˆê¸°í™”
        function resetResultsArea() {
            const resultsArea = document.getElementById('resultsArea');
            resultsArea.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 40vh; text-align: center;">
                    <div>
                        <h3 style="color: #666; margin-bottom: 20px;">ğŸ“Š í‰ê°€ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì‹œë ¤ë©´</h3>
                        <p style="font-size: 1.2em; color: #999;">ìœ„ì˜ 'ìµœì¢… ìˆœìœ„' ë˜ëŠ” 'ê²°ê³¼ ê³„ì‚°' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.</p>
                    </div>
                </div>
            `;
        }
        
        // ê´€ë¦¬ì ì¸ì¦ í•¨ìˆ˜
        async function authenticateAdmin(targetSection) {
            const password = await showPasswordPrompt();
            
            if (password === null) {
                // ì·¨ì†Œëœ ê²½ìš° í‰ê°€ ì°¸ì—¬ íƒ­ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.getElementById('evaluator').classList.add('active');
                document.querySelector('[onclick="showSection(\'evaluator\')"]').classList.add('active');
                return;
            }
            
            if (password === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                showAlert('ê´€ë¦¬ì ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                // ì¸ì¦ ì„±ê³µ í›„ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
                setTimeout(() => {
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.querySelectorAll('.nav-tab').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    document.getElementById(targetSection).classList.add('active');
                    document.querySelector(`[onclick="showSection('${targetSection}')"]`).classList.add('active');
                    
                    if (targetSection === 'admin') {
                        refreshStatus();
                    }
                }, 1000);
            } else {
                showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                
                // ì¸ì¦ ì‹¤íŒ¨ ì‹œ í‰ê°€ ì°¸ì—¬ íƒ­ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.getElementById('evaluator').classList.add('active');
                document.querySelector('[onclick="showSection(\'evaluator\')"]').classList.add('active');
            }
        }
        
        function startEvaluation() {
            const type = document.getElementById('evaluatorType').value;
            let name, dept;
            
            if (type === 'executive') {
                const position = document.getElementById('evaluatorPosition').value;
                if (!position) {
                    showAlert('ì§ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                name = position;
                dept = position;
            } else if (type === 'employee') {
                name = document.getElementById('evaluatorName').value;
                dept = document.getElementById('evaluatorDept').value;
                if (!name || !dept) {
                    showAlert('ì„±ëª…ê³¼ ì†Œì†ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else {
                showAlert('í‰ê°€ì êµ¬ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì¤‘ë³µ í‰ê°€ ì²´í¬
            const evaluatorKey = type === 'executive' ? dept : `${name}_${dept}`;
            if (completedEvaluators.includes(evaluatorKey)) {
                showAlert('ì´ë¯¸ í‰ê°€ë¥¼ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤.\nì¤‘ë³µ í‰ê°€ëŠ” ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            currentEvaluator = { type, name, dept };
            
            let targetDepartments = [...departments];
            
            if (type === 'executive') {
                const executive = executives.find(e => e.name === dept);
                if (executive) {
                    targetDepartments = targetDepartments.filter(d => !executive.cannotEvaluate.includes(d));
                }
            } else {
                targetDepartments = targetDepartments.filter(d => d !== dept);
            }
            
            evaluations = targetDepartments.map(dept => ({
                department: dept,
                creativity: '',
                difficulty: '',
                effectiveness: '',
                spreadability: '',
                contribution: '',
                total: 0
            }));
            
            currentPage = 0;
            
            document.getElementById('evaluatorLogin').classList.add('hidden');
            document.getElementById('evaluationArea').classList.remove('hidden');
            
            updateEvaluationPage();
        }
        
        function updateEvaluationPage() {
            if (evaluations.length === 0) return;
            
            const current = evaluations[currentPage];
            document.getElementById('currentDeptName').textContent = current.department;
            document.getElementById('creativity').value = current.creativity;
            document.getElementById('difficulty').value = current.difficulty;
            document.getElementById('effectiveness').value = current.effectiveness;
            document.getElementById('spreadability').value = current.spreadability;
            document.getElementById('contribution').value = current.contribution;
            
            updateTotalScore();
            
            document.getElementById('pageInfo').textContent = `${currentPage + 1} / ${evaluations.length}`;
            document.getElementById('prevBtn').style.display = 'inline-block'; // í•­ìƒ í‘œì‹œ
            document.getElementById('nextBtn').style.display = currentPage < evaluations.length - 1 ? 'inline-block' : 'none';
            document.getElementById('submitBtn').style.display = currentPage === evaluations.length - 1 ? 'inline-block' : 'none';
            
            const progress = ((currentPage + 1) / evaluations.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }
        
        function saveCurrentEvaluation() {
            if (evaluations.length === 0) return;
            
            const current = evaluations[currentPage];
            current.creativity = parseInt(document.getElementById('creativity').value) || 0;
            current.difficulty = parseInt(document.getElementById('difficulty').value) || 0;
            current.effectiveness = parseInt(document.getElementById('effectiveness').value) || 0;
            current.spreadability = parseInt(document.getElementById('spreadability').value) || 0;
            current.contribution = parseInt(document.getElementById('contribution').value) || 0;
            current.total = current.creativity + current.difficulty + current.effectiveness + current.spreadability + current.contribution;
        }
        
        function updateTotalScore() {
            const creativity = parseInt(document.getElementById('creativity').value) || 0;
            const difficulty = parseInt(document.getElementById('difficulty').value) || 0;
            const effectiveness = parseInt(document.getElementById('effectiveness').value) || 0;
            const spreadability = parseInt(document.getElementById('spreadability').value) || 0;
            const contribution = parseInt(document.getElementById('contribution').value) || 0;
            
            const total = creativity + difficulty + effectiveness + spreadability + contribution;
            document.getElementById('totalScore').value = total > 0 ? total : '';
            
            // ì´ì ì´ 100ì ì„ ì´ˆê³¼í•˜ëŠ” ê²½ìš° ê²½ê³ 
            if (total > 100) {
                document.getElementById('totalScore').style.color = 'red';
                document.getElementById('totalScore').style.fontWeight = 'bold';
            } else {
                document.getElementById('totalScore').style.color = '';
                document.getElementById('totalScore').style.fontWeight = '';
            }
        }
        
        function validateScore(input, min, max) {
            const value = parseInt(input.value);
            
            if (input.value !== '' && (isNaN(value) || value < min || value > max)) {
                input.style.borderColor = 'red';
                input.style.backgroundColor = '#ffe6e6';
                return false;
            } else {
                input.style.borderColor = '#e9ecef';
                input.style.backgroundColor = '';
                return true;
            }
        }
        
        function validateAllScores() {
            const creativity = document.getElementById('creativity');
            const difficulty = document.getElementById('difficulty');
            const effectiveness = document.getElementById('effectiveness');
            const spreadability = document.getElementById('spreadability');
            const contribution = document.getElementById('contribution');
            
            let isValid = true;
            
            // ê° í•­ëª©ë³„ ì ìˆ˜ ê²€ì¦
            if (!validateScore(creativity, 18, 30)) isValid = false;
            if (!validateScore(difficulty, 18, 30)) isValid = false;
            if (!validateScore(effectiveness, 12, 20)) isValid = false;
            if (!validateScore(spreadability, 6, 10)) isValid = false;
            if (!validateScore(contribution, 6, 10)) isValid = false;
            
            // ë¹ˆ ê°’ ê²€ì¦
            if (!creativity.value || !difficulty.value || !effectiveness.value || 
                !spreadability.value || !contribution.value) {
                showAlert('ëª¨ë“  í•­ëª©ì— ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            // ì´ì  ê²€ì¦
            const total = parseInt(creativity.value) + parseInt(difficulty.value) + 
                         parseInt(effectiveness.value) + parseInt(spreadability.value) + 
                         parseInt(contribution.value);
            
            if (total > 100) {
                showAlert('ì´ì ì´ 100ì ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜„ì¬ ì´ì : ' + total + 'ì ');
                return false;
            }
            
            if (!isValid) {
                showAlert('ì ìˆ˜ ë²”ìœ„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.\nì°½ì˜ì„±: 18~30ì \në‚œì´ë„: 18~30ì \níš¨ê³¼ì„±: 12~20ì \nì „íŒŒì„±: 6~10ì \nê¸°ì—¬ë„: 6~10ì ');
                return false;
            }
            
            return true;
        }
        
        function previousEvaluation() {
            if (currentPage > 0) {
                // í˜„ì¬ í˜ì´ì§€ê°€ 1í˜ì´ì§€ê°€ ì•„ë‹Œ ê²½ìš° ì´ì „ í˜ì´ì§€ë¡œ
                saveCurrentEvaluation();
                currentPage--;
                updateEvaluationPage();
            } else {
                // í˜„ì¬ í˜ì´ì§€ê°€ 1í˜ì´ì§€ì¸ ê²½ìš° í‰ê°€ì ì •ë³´ ì…ë ¥ í™”ë©´ìœ¼ë¡œ
                document.getElementById('evaluationArea').classList.add('hidden');
                document.getElementById('evaluatorLogin').classList.remove('hidden');
            }
        }
        
        function nextEvaluation() {
            if (currentPage < evaluations.length - 1) {
                if (!validateAllScores()) {
                    return;
                }
                saveCurrentEvaluation();
                currentPage++;
                updateEvaluationPage();
            }
        }
        
        function showPreview() {
            if (!validateAllScores()) {
                return;
            }
            
            saveCurrentEvaluation();
            
            // ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© ìƒì„±
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = '';
            
            // í‰ê°€ì ì •ë³´ í‘œì‹œ
            const evaluatorInfo = document.createElement('div');
            evaluatorInfo.className = 'evaluation-item';
            evaluatorInfo.style.backgroundColor = '#e3f2fd';
            evaluatorInfo.style.marginBottom = '20px';
            evaluatorInfo.innerHTML = `
                <div style="width: 100%;">
                    <h4 style="margin-bottom: 10px; color: #1976d2;">í‰ê°€ì ì •ë³´</h4>
                    <p><strong>êµ¬ë¶„:</strong> ${currentEvaluator.type === 'executive' ? 'ì„ì›' : 'ì§ì›'}</p>
                    <p><strong>ì„±ëª…/ì§ìœ„:</strong> ${currentEvaluator.name}</p>
                    ${currentEvaluator.type === 'employee' ? `<p><strong>ì†Œì†:</strong> ${currentEvaluator.dept}</p>` : ''}
                </div>
            `;
            previewContent.appendChild(evaluatorInfo);
            
            // ê° ë¶€ì„œë³„ í‰ê°€ ê²°ê³¼ í‘œì‹œ
            evaluations.forEach((evaluation, index) => {
                const card = document.createElement('div');
                card.className = 'evaluation-item';
                card.style.flexDirection = 'column';
                card.style.alignItems = 'flex-start';
                card.innerHTML = `
                    <h4 style="margin-bottom: 15px; color: #333;">${index + 1}. ${evaluation.department}</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                        <div>ì°½ì˜ì„±: <strong>${evaluation.creativity}ì </strong></div>
                        <div>ë‚œì´ë„: <strong>${evaluation.difficulty}ì </strong></div>
                        <div>íš¨ê³¼ì„±: <strong>${evaluation.effectiveness}ì </strong></div>
                        <div>ì „íŒŒì„±: <strong>${evaluation.spreadability}ì </strong></div>
                        <div>ê¸°ì—¬ë„: <strong>${evaluation.contribution}ì </strong></div>
                        <div style="grid-column: span 2; text-align: center; font-size: 1.2em; color: #28a745; font-weight: bold; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            ì´ì : ${evaluation.total}ì 
                        </div>
                    </div>
                `;
                previewContent.appendChild(card);
            });
            
            // í™”ë©´ ì „í™˜
            document.getElementById('evaluationArea').classList.add('hidden');
            document.getElementById('previewArea').classList.remove('hidden');
        }
        
        function returnToEvaluation() {
            // ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í‰ê°€ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸° (ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ)
            document.getElementById('previewArea').classList.add('hidden');
            document.getElementById('evaluationArea').classList.remove('hidden');
            currentPage = evaluations.length - 1;
            updateEvaluationPage();
        }
        
        function finalSubmission() {
            const evaluationData = {
                evaluator: currentEvaluator,
                evaluations: evaluations,
                timestamp: new Date().toISOString()
            };
            
            if (!allEvaluations) {
                allEvaluations = [];
            }
            allEvaluations.push(evaluationData);
            
            // ì™„ë£Œëœ í‰ê°€ì ëª©ë¡ì— ì¶”ê°€
            const evaluatorKey = currentEvaluator.type === 'executive' ? 
                currentEvaluator.dept : 
                `${currentEvaluator.name}_${currentEvaluator.dept}`;
            completedEvaluators.push(evaluatorKey);

            // Firebaseì— ì €ì¥
database.ref('allEvaluations').set(allEvaluations);
database.ref('completedEvaluators').set(completedEvaluators);

            
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // ê°ì‚¬ í™”ë©´ë§Œ í‘œì‹œ
            document.getElementById('thankYouScreen').classList.add('active');
            
            // ë³€ìˆ˜ ì´ˆê¸°í™”
            currentEvaluator = null;
            currentPage = 0;
            evaluations = [];
            
            // í‰ê°€ì ì…ë ¥ í¼ë„ ì´ˆê¸°í™”
            resetEvaluatorForm();
        }
        
        function resetEvaluatorForm() {
            // í‰ê°€ì ì •ë³´ ì…ë ¥ í¼ ì´ˆê¸°í™”
            document.getElementById('evaluatorType').value = '';
            document.getElementById('evaluatorPosition').value = '';
            document.getElementById('evaluatorName').value = '';
            document.getElementById('evaluatorDept').value = '';
            updateDepartmentOptions();
            
            // ëª¨ë“  í‰ê°€ ê´€ë ¨ í™”ë©´ ìˆ¨ê¸°ê¸°
            document.getElementById('evaluationArea').classList.add('hidden');
            document.getElementById('previewArea').classList.add('hidden');
            document.getElementById('thankYouArea').classList.add('hidden');
            
            // í‰ê°€ì ë¡œê·¸ì¸ í™”ë©´ë§Œ ë³´ì´ê¸°
            document.getElementById('evaluatorLogin').classList.remove('hidden');
        }
        
        function submitAllEvaluations() {
            if (!validateAllScores()) {
                return;
            }
            
            saveCurrentEvaluation();
            
            const evaluationData = {
                evaluator: currentEvaluator,
                evaluations: evaluations,
                timestamp: new Date().toISOString()
            };
            
            if (!allEvaluations) {
                allEvaluations = [];
            }
            allEvaluations.push(evaluationData);
            
            showAlert('í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            document.getElementById('evaluationArea').classList.add('hidden');
            document.getElementById('evaluatorLogin').classList.remove('hidden');
            document.getElementById('evaluatorType').value = '';
            document.getElementById('evaluatorName').value = '';
            document.getElementById('evaluatorPosition').value = '';
            document.getElementById('evaluatorDept').value = '';
            updateDepartmentOptions();
        }
        
        function refreshStatus() {
            updateExecutiveStatus();
            updateEmployeeStatus();
        }
        
        function updateExecutiveStatus() {
            const container = document.getElementById('executiveStatus');
            container.innerHTML = '';
            
            executives.forEach(exec => {
                const completed = allEvaluations && allEvaluations.some(e => e.evaluator.type === 'executive' && e.evaluator.dept === exec.name);
                const card = document.createElement('div');
                card.className = `status-card ${completed ? 'status-complete' : 'status-incomplete'}`;
                card.innerHTML = `
                    <div>${exec.name}</div>
                    <div>${completed ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}</div>
                `;
                container.appendChild(card);
            });
        }
        
        function updateEmployeeStatus() {
            const container = document.getElementById('employeeStatus');
            container.innerHTML = '';
            
            allDepartments.forEach(dept => {
                const evaluations = allEvaluations ? allEvaluations.filter(e => e.evaluator.type === 'employee' && e.evaluator.dept === dept) : [];
                const card = document.createElement('div');
                card.className = `status-card ${evaluations.length >= 2 ? 'status-complete' : 'status-incomplete'}`;
                card.innerHTML = `
                    <div>${dept}</div>
                    <div>${evaluations.length}/2 ì™„ë£Œ</div>
                `;
                container.appendChild(card);
            });
        }
        
        function calculateResults() {
            const results = {};
            
            departments.forEach(dept => {
                results[dept] = {
                    department: dept,
                    executiveScores: [],
                    employeeScores: [],
                    executiveAvg: 0,
                    employeeAvg: 0,
                    finalScore: 0
                };
            });
            
            allEvaluations.forEach(evalData => {
                evalData.evaluations.forEach(evaluation => {
                    if (results[evaluation.department]) {
                        if (evalData.evaluator.type === 'executive') {
                            results[evaluation.department].executiveScores.push(evaluation.total);
                        } else {
                            results[evaluation.department].employeeScores.push(evaluation.total);
                        }
                    }
                });
            });
            
            Object.values(results).forEach(result => {
                if (result.executiveScores.length > 0) {
                    result.executiveAvg = result.executiveScores.reduce((a, b) => a + b, 0) / result.executiveScores.length;
                }
                if (result.employeeScores.length > 0) {
                    result.employeeAvg = result.employeeScores.reduce((a, b) => a + b, 0) / result.employeeScores.length;
                }
                
                result.finalScore = (result.executiveAvg * 0.6) + (result.employeeAvg * 0.4);
            });
            
            displayResults(results);
        }
        
        function displayResults(results) {
            const container = document.getElementById('resultsArea');
            container.innerHTML = '';
            
            // ì ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            const sortedResults = Object.values(results).sort((a, b) => b.finalScore - a.finalScore);
            
            sortedResults.forEach((result, index) => {
                const card = document.createElement('div');
                card.className = 'result-card';
                
                // ìƒìœ„ 3ìœ„ì—ê²Œ íŠ¹ë³„í•œ ë°°ê²½ìƒ‰ ì ìš©
                if (index === 0) {
                    card.style.background = '#FFD700'; // 1ìœ„ - ê¸ˆìƒ‰
                } else if (index === 1) {
                    card.style.background = '#C0C0C0'; // 2ìœ„ - ì€ìƒ‰
                } else if (index === 2) {
                    card.style.background = '#CD7F32'; // 3ìœ„ - ë™ìƒ‰
                }
                
                card.innerHTML = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h2 style="font-size: 2em; margin-bottom: 10px; ${index < 3 ? 'color: #333;' : 'color: #007bff;'}">
                            ${index + 1}ìœ„: ${result.department}
                        </h2>
                    </div>
                    <div class="score-detail">
                        <span>ì„ì› í‰ê· </span>
                        <span>${result.executiveAvg.toFixed(1)}ì </span>
                    </div>
                    <div class="score-detail">
                        <span>ì§ì› í‰ê· </span>
                        <span>${result.employeeAvg.toFixed(1)}ì </span>
                    </div>
                    <div class="score-detail">
                        <span>ì„ì› ë°˜ì˜ (60%)</span>
                        <span>${(result.executiveAvg * 0.6).toFixed(1)}ì </span>
                    </div>
                    <div class="score-detail">
                        <span>ì§ì› ë°˜ì˜ (40%)</span>
                        <span>${(result.employeeAvg * 0.4).toFixed(1)}ì </span>
                    </div>
                    <div class="final-score">
                        ìµœì¢… ì ìˆ˜: ${result.finalScore.toFixed(1)}ì 
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        function showFinalRanking() {
            // ë¨¼ì € í‹°ì € í™”ë©´ í‘œì‹œ
            const container = document.getElementById('resultsArea');
            container.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 60vh; text-align: center; cursor: pointer;" onclick="startRankingReveal()">
                    <div>
                        <h2 style="font-size: 2.5em; color: #007bff; margin-bottom: 30px; line-height: 1.4;">
                            ê³¼ì—° 2025ë…„ë„ ìƒë°˜ê¸°<br>ì„œì‹œê³µ ì–´ì›Œë“œ 1ìœ„ë¥¼ ì°¨ì§€í• <br>ì˜ê´‘ì˜ ì£¼ì¸ê³µì€<br>ì–´ë–¤ ë¶€ì„œì¼ê¹Œìš”?
                        </h2>
                        <div style="margin-top: 40px;">
                            <div style="display: inline-block; width: 50px; height: 50px; border: 3px solid #007bff; border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                        <p style="margin-top: 30px; font-size: 1.2em; color: #666;">í™”ë©´ì„ í´ë¦­í•˜ì—¬ ìˆœìœ„ ë°œí‘œë¥¼ ì‹œì‘í•˜ì„¸ìš”!</p>
                    </div>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
        }
        
        function startRankingReveal() {
            // ê²°ê³¼ ê³„ì‚°
            const results = {};
            
            departments.forEach(dept => {
                results[dept] = {
                    department: dept,
                    executiveScores: [],
                    employeeScores: [],
                    executiveAvg: 0,
                    employeeAvg: 0,
                    finalScore: 0
                };
            });
            
            allEvaluations.forEach(evalData => {
                evalData.evaluations.forEach(evaluation => {
                    if (results[evaluation.department]) {
                        if (evalData.evaluator.type === 'executive') {
                            results[evaluation.department].executiveScores.push(evaluation.total);
                        } else {
                            results[evaluation.department].employeeScores.push(evaluation.total);
                        }
                    }
                });
            });
            
            Object.values(results).forEach(result => {
                if (result.executiveScores.length > 0) {
                    result.executiveAvg = result.executiveScores.reduce((a, b) => a + b, 0) / result.executiveScores.length;
                }
                if (result.employeeScores.length > 0) {
                    result.employeeAvg = result.employeeScores.reduce((a, b) => a + b, 0) / result.employeeScores.length;
                }
                
                result.finalScore = (result.executiveAvg * 0.6) + (result.employeeAvg * 0.4);
            });
            
            const sortedResults = Object.values(results).sort((a, b) => b.finalScore - a.finalScore);
            
            let currentStep = 0;
            
            function showStep() {
                const container = document.getElementById('resultsArea');
                
                switch(currentStep) {
                    case 0: // 5ìœ„~8ìœ„ í‘œì‹œ
                        container.innerHTML = `
                            <div style="text-align: center; cursor: pointer;" onclick="nextStep()">
                                <h3 style="margin-bottom: 30px; font-size: 2em;">ğŸ† ìµœì¢… ìˆœìœ„ ë°œí‘œ ğŸ†</h3>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 800px; margin: 0 auto;">
                                    ${sortedResults.slice(4).map((result, index) => `
                                        <div class="result-card" style="background: #f8f9fa;">
                                            <h2 style="text-align: center; margin-bottom: 15px; color: #666;">
                                                ${index + 5}ìœ„: ${result.department}
                                            </h2>
                                            <div class="final-score" style="color: #666;">
                                                ${result.finalScore.toFixed(1)}ì 
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <p style="margin-top: 30px; font-size: 1.2em; color: #666;">í™”ë©´ì„ í´ë¦­í•˜ì—¬ ê³„ì†...</p>
                            </div>
                        `;
                        break;
                        
                    case 1: // 4ìœ„ í‘œì‹œ
                        container.innerHTML = `
                            <div style="text-align: center; cursor: pointer;" onclick="nextStep()">
                                <h3 style="margin-bottom: 30px; font-size: 2em;">ğŸ¥‰ 4ìœ„ ë°œí‘œ ğŸ¥‰</h3>
                                <div style="max-width: 400px; margin: 0 auto;">
                                    <div class="result-card" style="background: #e8e8e8; transform: scale(1.1);">
                                        <h2 style="text-align: center; margin-bottom: 15px; font-size: 2em;">
                                            4ìœ„: ${sortedResults[3].department}
                                        </h2>
                                        <div class="final-score" style="font-size: 2em;">
                                            ${sortedResults[3].finalScore.toFixed(1)}ì 
                                        </div>
                                    </div>
                                </div>
                                <p style="margin-top: 30px; font-size: 1.2em; color: #666;">í™”ë©´ì„ í´ë¦­í•˜ì—¬ ê³„ì†...</p>
                            </div>
                        `;
                        break;
                        
                    case 2: // 3ìœ„ í‘œì‹œ
                        container.innerHTML = `
                            <div style="text-align: center; cursor: pointer;" onclick="nextStep()">
                                <h3 style="margin-bottom: 30px; font-size: 2em;">ğŸ¥‰ 3ìœ„ ë°œí‘œ ğŸ¥‰</h3>
                                <div style="max-width: 400px; margin: 0 auto;">
                                    <div class="result-card" style="background: #CD7F32; color: white; transform: scale(1.1);">
                                        <h2 style="text-align: center; margin-bottom: 15px; font-size: 2em; color: white;">
                                            3ìœ„: ${sortedResults[2].department}
                                        </h2>
                                        <div class="final-score" style="font-size: 2em; background: rgba(255,255,255,0.2);">
                                            ${sortedResults[2].finalScore.toFixed(1)}ì 
                                        </div>
                                    </div>
                                </div>
                                <p style="margin-top: 30px; font-size: 1.2em; color: #666;">í™”ë©´ì„ í´ë¦­í•˜ì—¬ ê³„ì†...</p>
                            </div>
                        `;
                        break;
                        
                    case 3: // 1ìœ„ vs 2ìœ„ ëŒ€ê²° êµ¬ë„ (ì ìˆ˜ì™€ ìˆœìœ„ ìˆ¨ê¹€, ë°°ê²½ìƒ‰ í†µì¼)
                        container.innerHTML = `
                            <div style="text-align: center; cursor: pointer;" onclick="nextStep()">
                                <h2 style="font-size: 2.5em; color: #007bff; margin-bottom: 50px; line-height: 1.4;">
                                    ê³¼ì—° ìµœì¢… 1ìœ„ëŠ”<br>ì–´ë–¤ ë¶€ì„œì¼ê¹Œìš”?
                                </h2>
                                <div style="display: flex; align-items: center; justify-content: center; gap: 50px; max-width: 800px; margin: 0 auto;">
                                    <div style="flex: 1; text-align: center;">
                                        <div style="background: #f8f9fa; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                                            <h2 style="font-size: 2.5em; color: #333;">${sortedResults[1].department}</h2>
                                        </div>
                                    </div>
                                    <div style="font-size: 3em; color: #007bff; font-weight: bold;">VS</div>
                                    <div style="flex: 1; text-align: center;">
                                        <div style="background: #f8f9fa; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                                            <h2 style="font-size: 2.5em; color: #333;">${sortedResults[0].department}</h2>
                                        </div>
                                    </div>
                                </div>
                                <p style="margin-top: 50px; font-size: 1.2em; color: #666;">í™”ë©´ì„ í´ë¦­í•˜ì—¬ 1ìœ„ ë°œí‘œë¥¼ í™•ì¸í•˜ì„¸ìš”!</p>
                            </div>
                        `;
                        break;
                        
                    case 4: // 1ìœ„ ìµœì¢… ë°œí‘œ
                        container.innerHTML = `
                            <div style="text-align: center;">
                                <div style="margin-bottom: 30px;">
                                    <h1 style="font-size: 4em; color: #FFD700; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); margin-bottom: 20px;">
                                        ğŸ† ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ†
                                    </h1>
                                    <h2 style="font-size: 3em; color: #007bff; margin-bottom: 30px;">
                                        2025ë…„ë„ ìƒë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œ 1ìœ„
                                    </h2>
                                </div>
                                <div style="max-width: 600px; margin: 0 auto;">
                                    <div class="result-card" style="background: linear-gradient(135deg, #FFD700, #FFA500); color: #333; transform: scale(1.2); box-shadow: 0 20px 40px rgba(255, 215, 0, 0.4);">
                                        <h1 style="text-align: center; margin-bottom: 20px; font-size: 3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">
                                            ğŸ¥‡ ${sortedResults[0].department} ğŸ¥‡
                                        </h1>
                                        <div style="font-size: 2.5em; font-weight: bold; background: rgba(255,255,255,0.3); border-radius: 10px; padding: 20px;">
                                            ìµœì¢… ì ìˆ˜: ${sortedResults[0].finalScore.toFixed(1)}ì 
                                        </div>
                                    </div>
                                </div>
                                <div style="margin-top: 40px; font-size: 1.5em; color: #666;">
                                    ğŸ‰ ìƒë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œ 1ìœ„ ìˆ˜ìƒì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤! ğŸ‰
                                </div>
                            </div>
                        `;
                        break;
                }
            }
            
            // ì „ì—­ í•¨ìˆ˜ë¡œ nextStep ì •ì˜
            window.nextStep = function() {
                currentStep++;
                if (currentStep <= 4) {
                    showStep();
                }
            };
            
            // ì²« ë²ˆì§¸ ë‹¨ê³„ ì‹œì‘
            showStep();
        }
        
        function exportResults() {
            if (allEvaluations.length === 0) {
                showAlert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            let csvContent = "í‰ê°€ìêµ¬ë¶„,í‰ê°€ìëª…,í‰ê°€ìì†Œì†,í‰ê°€ë¶€ì„œ,ì°½ì˜ì„±,ë‚œì´ë„,íš¨ê³¼ì„±,ì „íŒŒì„±,ê¸°ì—¬ë„,ì´ì \n";
            
            allEvaluations.forEach(evalData => {
                evalData.evaluations.forEach(evaluation => {
                    csvContent += `${evalData.evaluator.type === 'executive' ? 'ì„ì›' : 'ì§ì›'},${evalData.evaluator.name},${evalData.evaluator.dept},${evaluation.department},${evaluation.creativity},${evaluation.difficulty},${evaluation.effectiveness},${evaluation.spreadability},${evaluation.contribution},${evaluation.total}\n`;
                });
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'í‰ê°€ê²°ê³¼.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        async function resetAllData() {
    const result = await showConfirm('ëª¨ë“  í‰ê°€ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
    if (result) {
        allEvaluations = [];
        completedEvaluators = [];
        
        // Firebaseì—ì„œë„ ì‚­ì œ
        database.ref('allEvaluations').remove();
        database.ref('completedEvaluators').remove();
        
        showAlert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        refreshStatus();
    }
}
        
        function showDeleteEvaluator() {
            const deleteSection = document.getElementById('deleteSection');
            
            // í˜„ì¬ ë³´ì´ëŠ” ìƒíƒœë¼ë©´ ìˆ¨ê¸°ê¸°
            if (!deleteSection.classList.contains('hidden')) {
                hideDeleteEvaluator();
                return;
            }
            
            const select = document.getElementById('deleteEvaluatorSelect');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            
            // ì™„ë£Œëœ í‰ê°€ì ëª©ë¡ì„ ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— ì¶”ê°€
            if (allEvaluations && allEvaluations.length > 0) {
                allEvaluations.forEach((evalData, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    const evaluatorType = evalData.evaluator.type === 'executive' ? 'ì„ì›' : 'ì§ì›';
                    const evaluatorInfo = evalData.evaluator.type === 'executive' ? 
                        evalData.evaluator.name : 
                        `${evalData.evaluator.name} (${evalData.evaluator.dept})`;
                    option.textContent = `${evaluatorType} - ${evaluatorInfo}`;
                    select.appendChild(option);
                });
            }
            
            deleteSection.classList.remove('hidden');
        }
        
        function hideDeleteEvaluator() {
            document.getElementById('deleteSection').classList.add('hidden');
        }
        
        async function deleteSelectedEvaluator() {
            const selectedIndex = document.getElementById('deleteEvaluatorSelect').value;
            
            if (selectedIndex === '') {
                showAlert('ì‚­ì œí•  í‰ê°€ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const evalData = allEvaluations[selectedIndex];
            const evaluatorType = evalData.evaluator.type === 'executive' ? 'ì„ì›' : 'ì§ì›';
            const evaluatorInfo = evalData.evaluator.type === 'executive' ? 
                evalData.evaluator.name : 
                `${evalData.evaluator.name} (${evalData.evaluator.dept})`;
            
            const result = await showConfirm(`${evaluatorType} - ${evaluatorInfo}ì˜ í‰ê°€ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
            if (result) {
                // allEvaluationsì—ì„œ í•´ë‹¹ ë°ì´í„° ì‚­ì œ
                allEvaluations.splice(selectedIndex, 1);
                
                // completedEvaluatorsì—ì„œë„ í•´ë‹¹ í‰ê°€ì ì œê±°
                const evaluatorKey = evalData.evaluator.type === 'executive' ? 
                    evalData.evaluator.dept : 
                    `${evalData.evaluator.name}_${evalData.evaluator.dept}`;
                const keyIndex = completedEvaluators.indexOf(evaluatorKey);
                if (keyIndex > -1) {
                    completedEvaluators.splice(keyIndex, 1);
                }
                
                // Firebaseì—ë„ ì—…ë°ì´íŠ¸ (ìƒˆë¡œ ì¶”ê°€ëœ ë¶€ë¶„!)
        database.ref('allEvaluations').set(allEvaluations);
        database.ref('completedEvaluators').set(completedEvaluators);

                showAlert('ì„ íƒí•œ í‰ê°€ìì˜ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                hideDeleteEvaluator();
                refreshStatus();
            }
        }
    </script>
</body>
</html>